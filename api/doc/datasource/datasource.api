syntax = "v1"

type (
	// 基础分页参数
	PageBaseInfo {
		Offset int `form:"offset,default=1,range=[1:]"`
		Limit  int `form:"limit,default=10,range=[0:2000]"`
	}
	// 完整分页参数（含排序）
	PageInfo {
		PageBaseInfo
		Direction string `form:"direction,default=desc,options=asc|desc"`
		Sort      string `form:"sort,default=created_at,options=created_at|updated_at"`
	}
	// 关键字搜索
	KeywordInfo {
		Keyword string `form:"keyword,optional"`
	}
	// 分页+关键字组合
	PageInfoWithKeyword {
		PageInfo
		KeywordInfo
	}
	// 创建数据源请求
	CreateDataSourceReq {
		Name        string `json:"name" validate:"required,max=100"`
		Type        string `json:"type" validate:"required,oneof=mysql postgresql redis mongodb sqlserver"`
		Host        string `json:"host" validate:"required,max=200"`
		Port        int    `json:"port" validate:"required,min=1,max=65535"`
		Database    string `json:"database" validate:"max=100"`
		Username    string `json:"username" validate:"required,max=100"`
		Password    string `json:"password" validate:"required,max=200"`
		Description string `json:"description" validate:"max=500"`
		Status      string `json:"status" validate:"oneof=enabled disabled"`
		SortOrder   int    `json:"sort_order" validate:"omitempty"`
	}
	// 创建数据源响应
	CreateDataSourceResp {
		Id        string `json:"id"`
		CreatedAt string `json:"created_at"`
	}
	// 列表查询请求
	ListDataSourceReq {
		PageInfoWithKeyword
		Status string `form:"status,optional"`
	}
	// 列表查询响应
	ListDataSourceResp {
		Entries    []DataSourceResp `json:"entries"`
		TotalCount int64            `json:"total_count"`
	}
	// 数据源响应
	DataSourceResp {
		Id          string `json:"id"`
		Name        string `json:"name"`
		Type        string `json:"type"`
		Host        string `json:"host"`
		Port        int    `json:"port"`
		Database    string `json:"database"`
		Description string `json:"description"`
		Status      string `json:"status"`
		SortOrder   int    `json:"sort_order"`
		CreatedAt   string `json:"created_at"`
		UpdatedAt   string `json:"updated_at"`
	}
)

@server (
	prefix: /api/v1/datasource
	group:  datasource
)
service spec_cc_0104_api {
	@handler CreateDataSource
	post / (CreateDataSourceReq) returns (CreateDataSourceResp)

	@handler ListDataSource
	get / (ListDataSourceReq) returns (ListDataSourceResp)
}

