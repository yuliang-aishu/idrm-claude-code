# 场景二：小改动

> **适用于**: Bug 修复、参数调整、性能优化，变更 < 50 行

---

## 适用条件

| 条件 | 状态 |
|------|------|
| specs/{feature}/ 目录 | ✅ 存在 |
| 已有 spec.md | ✅ 存在 |
| 变更规模 | 🔧 小 (< 50 行) |
| 是否涉及新需求 | ❌ 否 |
| 是否涉及架构变更 | ❌ 否 |

---

## 典型场景

- Bug 修复
- 参数调整
- 性能优化
- UI 微调
- 文案修改

---

## 工作流总览

```
Step 1: 识别改动点
    ↓
Step 2: 更新 tasks.md (添加修复任务)
    ↓
Step 3: 执行实现
    ↓
Step 4: 更新版本历史
```

> ⚡ **快速路径**: 通常 30 分钟内完成

---

## Step 1: 识别改动点

### 目标
定位需要修改的代码位置

### 活动
1. 查找相关的 spec.md 中的 AC
2. 查找对应的 plan.md 中的设计
3. 定位实际代码文件

### 输出
- 明确的改动位置和原因

### 检查清单
- [ ] 已定位到相关 AC
- [ ] 已理解原有设计
- [ ] 已找到代码位置

---

## Step 2: 更新 tasks.md

### 目标
添加修复任务到任务列表

### 活动
在 `specs/{feature}/tasks.md` 中添加:

```markdown
---

## 修复/优化任务

### Task N: [FIX] 修复问题标题

**引用**: spec.md#AC-xx
**问题描述**: 简述问题
**预计代码**: ~20 行

**修复步骤**:
1. 修改 xxx 文件
2. 更新 yyy 逻辑

**验收**: 问题已解决，测试通过
```

### 检查清单
- [ ] 任务描述清晰
- [ ] 引用了相关 AC
- [ ] 有明确验收标准

---

## Step 3: 执行实现

### 目标
执行修复任务

### 活动
1. 按任务步骤修改代码
2. 运行相关测试
3. 验证问题已修复

### 检查清单
- [ ] 代码已修改
- [ ] 测试通过
- [ ] 问题已验证解决

---

## Step 4: 更新版本历史

### 目标
记录变更历史

### 活动
在 `specs/{feature}/spec.md` 的 Revision History 中添加:

```markdown
| 1.1 | 2026-01-03 | 修复人 | 修复: xxx 问题 |
```

### 输出
- 更新的 spec.md

---

## 示例

### 问题: 登录接口响应慢

```
Step 1: 识别改动点
  - spec.md: AC-04 登录成功
  - plan.md: API-02 POST /auth/login
  - 代码: api/internal/logic/auth/loginlogic.go

Step 2: 更新 tasks.md
  ### Task 8: [FIX] 优化登录查询性能
  **引用**: spec.md#AC-04
  **问题描述**: 登录查询未使用索引
  **修复步骤**:
  1. 添加 phone 字段索引
  2. 优化查询语句

Step 3: 执行实现
  - 修改 migrations/002_add_phone_index.sql
  - 修改 model/user.go

Step 4: 更新版本历史
  | 1.1 | 2026-01-03 | AI | 修复: 登录查询性能优化 |
```

---

## 触发命令

```
/speckit.start 修复登录超时问题
/speckit.start 优化用户查询性能
/speckit.start 调整密码最小长度为 10 位
```

---

## 边界判断

### 何时升级到场景三（扩展）？

如果发现:
- 需要添加新的 API 端点
- 需要新增数据库字段
- 预计变更 > 50 行

→ 使用场景三

### 何时升级到场景四（重构）？

如果发现:
- 需要修改接口签名
- 涉及破坏性变更
- 需要数据迁移

→ 使用场景四
